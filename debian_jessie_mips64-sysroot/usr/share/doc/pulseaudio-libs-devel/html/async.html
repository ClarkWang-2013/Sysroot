<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>PulseAudio: Asynchronous API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PulseAudio
   &#160;<span id="projectnumber">6.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('async.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Asynchronous API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="overv_sec"></a>
Overview</h1>
<p>The asynchronous API is the native interface to the PulseAudio library. It allows full access to all available functionality. This however means that it is rather complex and can take some time to fully master.</p>
<h1><a class="anchor" id="mainloop_sec"></a>
Main Loop Abstraction</h1>
<p>The API is based around an asynchronous event loop, or main loop, abstraction. This abstraction contains three basic elements:</p>
<ul>
<li>Deferred events - Events that will trigger as soon as possible. Note that some implementations may block all other events when a deferred event is active. </li>
<li>I/O events - Events that trigger on file descriptor activities. </li>
<li>Times events - Events that trigger after a fixed amount of time.</li>
</ul>
<p>The abstraction is represented as a number of function pointers in the <a class="el" href="structpa__mainloop__api.html" title="An abstract mainloop API vtable. ">pa_mainloop_api</a> structure.</p>
<p>To actually be able to use these functions, an implementation needs to be coupled to the abstraction. There are three of these shipped with PulseAudio, but any other can be used with a minimal amount of work, provided it supports the three basic events listed above.</p>
<p>The implementations shipped with PulseAudio are:</p>
<ul>
<li><a class="el" href="mainloop.html">Main Loop</a> - A minimal but fast implementation based on poll(). </li>
<li><a class="el" href="threaded_mainloop.html">Threaded Main Loop</a> - A special version of the previous implementation where all of PulseAudio's internal handling runs in a separate thread. </li>
<li><a class="el" href="glib-mainloop.html">GLIB Main Loop Bindings</a> - A wrapper around GLib's main loop.</li>
</ul>
<p>UNIX signals may be hooked to a main loop using the functions from <a class="el" href="mainloop-signal_8h.html">mainloop-signal.h</a>. These rely only on the main loop abstraction and can therefore be used with any of the implementations.</p>
<h1><a class="anchor" id="refcnt_sec"></a>
Reference Counting</h1>
<p>Almost all objects in PulseAudio are reference counted. What that means is that you rarely malloc() or free() any objects. Instead you increase and decrease their reference counts. Whenever an object's reference count reaches zero, that object gets destroy and any resources it uses get freed.</p>
<p>The benefit of this design is that an application need not worry about whether or not it needs to keep an object around in case the library is using it internally. If it is, then it has made sure it has its own reference to it.</p>
<p>Whenever the library creates an object, it will have an initial reference count of one. Most of the time, this single reference will be sufficient for the application, so all required reference count interaction will be a single call to the object's unref function.</p>
<h1><a class="anchor" id="context_sec"></a>
Context</h1>
<p>A context is the basic object for a connection to a PulseAudio server. It multiplexes commands, data streams and events through a single channel.</p>
<p>There is no need for more than one context per application, unless connections to multiple servers are needed.</p>
<h2><a class="anchor" id="ops_subsec"></a>
Operations</h2>
<p>All operations on the context are performed asynchronously. I.e. the client will not wait for the server to complete the request. To keep track of all these in-flight operations, the application is given a pa_operation object for each asynchronous operation.</p>
<p>There are only two actions (besides reference counting) that can be performed on a pa_operation: querying its state with <a class="el" href="operation_8h.html#acabeaea114e87658e1dadc214d7a2c35" title="Return the current status of the operation. ">pa_operation_get_state()</a> and aborting it with <a class="el" href="operation_8h.html#a2629761f072c1ffa8114dd85220768f6" title="Cancel the operation. ">pa_operation_cancel()</a>.</p>
<p>A pa_operation object is reference counted, so an application must make sure to unreference it, even if it has no intention of using it.</p>
<h2><a class="anchor" id="conn_subsec"></a>
Connecting</h2>
<p>A context must be connected to a server before any operation can be issued. Calling <a class="el" href="context_8h.html#a983ce13d45c5f4b0db8e1a34e21f9fce" title="Connect the context to the specified server. ">pa_context_connect()</a> will initiate the connection procedure. Unlike most asynchronous operations, connecting does not result in a pa_operation object. Instead, the application should register a callback using <a class="el" href="context_8h.html#aeb7b395fd3a345fc181d6bfcdbe5f3d8" title="Set a callback function that is called whenever the context status changes. ">pa_context_set_state_callback()</a>.</p>
<h2><a class="anchor" id="disc_subsec"></a>
Disconnecting</h2>
<p>When the sound support is no longer needed, the connection needs to be closed using <a class="el" href="context_8h.html#a154b9d8057adfbb2cecfbd9406a27660" title="Terminate the context connection immediately. ">pa_context_disconnect()</a>. This is an immediate function that works synchronously.</p>
<p>Since the context object has references to other objects it must be disconnected after use or there is a high risk of memory leaks. If the connection has terminated by itself, then there is no need to explicitly disconnect the context using <a class="el" href="context_8h.html#a154b9d8057adfbb2cecfbd9406a27660" title="Terminate the context connection immediately. ">pa_context_disconnect()</a>.</p>
<h1><a class="anchor" id="Functions"></a>
Functions</h1>
<p>The sound server's functionality can be divided into a number of subsections:</p>
<ul>
<li><a class="el" href="streams.html">Audio Streams</a> </li>
<li><a class="el" href="scache.html">Sample Cache</a> </li>
<li><a class="el" href="introspect.html">Server Query and Control</a> </li>
<li><a class="el" href="subscribe.html">Event Subscription</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
